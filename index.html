<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>摄像头体检</title>
    <style>
        body { background: #333; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; text-align: center; }
        video { width: 80%; max-width: 400px; background: black; margin-top: 20px; border: 2px solid #fff; }
        button { padding: 15px 30px; font-size: 18px; background: #00d2ff; border: none; border-radius: 8px; margin-bottom: 20px; }
    </style>
</head>
<body>

    <h3>摄像头体检工具</h3>
    <button id="btn" onclick="testCamera()">点击测试摄像头</button>
    <div id="log">等待操作...</div>
    <video id="vid" playsinline autoplay></video>

    <script>
        function log(text) {
            document.getElementById('log').innerText = text;
            console.log(text);
        }

        async function testCamera() {
            log("1. 按钮已点击，正在检查环境...");
            
            // 检查 HTTPS
            if (!window.isSecureContext) {
                log("❌ 失败：当前不是 HTTPS 环境！");
                alert("错误：请使用 https:// 访问");
                return;
            }

            // 检查 API 是否存在
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                log("❌ 失败：浏览器不支持 getUserMedia API");
                alert("你的浏览器太旧或不支持摄像头调用");
                return;
            }

            log("2. 环境正常，正在请求权限...");

            try {
                // 尝试获取后置摄像头
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment' 
                    } 
                });
                
                log("✅ 成功！已获取视频流");
                const video = document.getElementById('vid');
                video.srcObject = stream;
                video.play();
                
                document.getElementById('btn').style.display = 'none'; // 隐藏按钮

            } catch (err) {
                log("❌ 报错：" + err.name + " - " + err.message);
                alert("摄像头启动失败：\n" + err.name + "\n请检查浏览器权限设置！");
            }
        }
    </script>
</body>
</html>
